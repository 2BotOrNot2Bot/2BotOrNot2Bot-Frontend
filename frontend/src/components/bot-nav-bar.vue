<!--@Description: Main navigation bar located at the top of main chatting window and home page-->
<!--@author Tianyi(Lorena) Yan-->

<template>
  <div id="navBar">
    <svg @click="goHome" id="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 97.18 97.18"><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-1" fill="#fff" d="M38.32,76.92a3.31,3.31,0,0,0-1.93-.14,3.27,3.27,0,0,0-1.67,1A6.05,6.05,0,0,0,33.46,80,6.23,6.23,0,0,0,33,82.46a3.43,3.43,0,0,0,.64,1.87,3.33,3.33,0,0,0,1.57,1.12,3.28,3.28,0,0,0,1.92.14,3.32,3.32,0,0,0,1.68-1,7.18,7.18,0,0,0,1.69-4.67,3.17,3.17,0,0,0-2.2-3Z"/><path class="cls-1" fill="#fff" d="M26.18,20.38a1.74,1.74,0,0,0,.18-.94,1.59,1.59,0,0,0-.4-.9A1.51,1.51,0,0,0,24.77,18a2.22,2.22,0,0,0-1.45.62L21.62,20l2.22,2.63,1.66-1.41A2.38,2.38,0,0,0,26.18,20.38Z"/><path class="cls-1" fill="#fff" d="M41.65,12a3.29,3.29,0,0,0-1.59-1.15,3.25,3.25,0,0,0-1.93,0,3.3,3.3,0,0,0-1.66,1,3.4,3.4,0,0,0-.77,1.8,6,6,0,0,0,.24,2.51A6.21,6.21,0,0,0,37,18.4a3.43,3.43,0,0,0,1.59,1.15,3.33,3.33,0,0,0,1.93,0,3.37,3.37,0,0,0,1.66-1A3.43,3.43,0,0,0,43,16.75a6,6,0,0,0-.24-2.51A6.23,6.23,0,0,0,41.65,12Z"/><path class="cls-1" fill="#fff" d="M20.88,65.24a3.43,3.43,0,0,0,.85-1.77,3.39,3.39,0,0,0-.33-1.9,3.28,3.28,0,0,0-1.28-1.46,3.49,3.49,0,0,0-1.91-.45,6.41,6.41,0,0,0-2.43.68,6.15,6.15,0,0,0-2,1.47,3.4,3.4,0,0,0-.85,1.77,3.23,3.23,0,0,0,.33,1.9,3.19,3.19,0,0,0,3.19,1.9,6.29,6.29,0,0,0,2.42-.67A6.49,6.49,0,0,0,20.88,65.24Z"/><path class="cls-1" fill="#fff" d="M13.6,49.29a3.73,3.73,0,0,0-.25-1.4,1.69,1.69,0,0,0-.71-.82,2.15,2.15,0,0,0-1.15-.25,2.19,2.19,0,0,0-1.16.29,1.72,1.72,0,0,0-.71.85,3.59,3.59,0,0,0-.23,1.41l0,2,4.2-.07Z"/><path class="cls-1" fill="#fff" d="M51.09,82.31l2.45-.2-.3-3.68-2.39.19a2.81,2.81,0,0,0-1.74.62,1.56,1.56,0,0,0-.46,1.3,1.86,1.86,0,0,0,.36,1,1.91,1.91,0,0,0,.84.63A3,3,0,0,0,51.09,82.31Z"/><path class="cls-1" fill="#fff" d="M51.53,84.26a2.8,2.8,0,0,0-1.05.3,1.81,1.81,0,0,0-.7.67,1.62,1.62,0,0,0-.19,1,1.53,1.53,0,0,0,.63,1.17,2.22,2.22,0,0,0,1.54.34L54,87.51l-.28-3.42Z"/><path class="cls-1" fill="#fff" d="M76.69,27.71a3.47,3.47,0,0,0,1,1,1.65,1.65,0,0,0,1,.26,2.27,2.27,0,0,0,1.09-.46,2.2,2.2,0,0,0,.77-.92,1.68,1.68,0,0,0,.09-1.09,3.41,3.41,0,0,0-.64-1.28l-1.18-1.6-3.38,2.5Z"/><path class="cls-1" fill="#fff" d="M63.2,22.24a3.27,3.27,0,0,0,1.88.45A3.37,3.37,0,0,0,66.9,22a6.08,6.08,0,0,0,1.59-2,6.29,6.29,0,0,0,.83-2.38A3.43,3.43,0,0,0,69,15.67a3.38,3.38,0,0,0-1.37-1.36,3.34,3.34,0,0,0-1.88-.44,3.3,3.3,0,0,0-1.82.74,6,6,0,0,0-1.59,1.95A6.39,6.39,0,0,0,61.5,19a3.4,3.4,0,0,0,.33,1.93A3.27,3.27,0,0,0,63.2,22.24Z"/><path class="cls-1" fill="#fff" d="M85.17,55.76a7.16,7.16,0,0,0-4.77-1.35,3.35,3.35,0,0,0-1.81.76,3.6,3.6,0,0,0-1,3.58,3.36,3.36,0,0,0,1.14,1.6A6.41,6.41,0,0,0,81,61.45a6.33,6.33,0,0,0,2.51.25,3.17,3.17,0,0,0,2.82-2.41,3.25,3.25,0,0,0,0-1.93A3.36,3.36,0,0,0,85.17,55.76Z"/><path class="cls-1" fill="#fff" d="M29.33,25.44a2.81,2.81,0,0,0,1.07-1.52A1.56,1.56,0,0,0,30,22.6a1.72,1.72,0,0,0-.87-.6,1.87,1.87,0,0,0-1.05,0,2.8,2.8,0,0,0-1.09.59l-1.88,1.59L27.51,27Z"/><path class="cls-1" fill="#fff" d="M48.59,0A48.59,48.59,0,1,0,97.18,48.59,48.6,48.6,0,0,0,48.59,0ZM89,38.18l-7.57,7.41,0,.12,8.61-1.51.5,2.88-13.68,2.4L76.45,47,84,39.52l0-.1-8.61,1.51L74.88,38l13.69-2.4ZM82.33,24.23a6.15,6.15,0,0,1,1.15,2.5A4,4,0,0,1,83.22,29a4.85,4.85,0,0,1-1.58,1.89,4.63,4.63,0,0,1-2.27.94,3.87,3.87,0,0,1-2.25-.49L77,31.31l-2.59,5.58-1.93-2.61,2.4-5L73.6,27.51l-4,2.93L67.9,28.08l11.17-8.26Zm-20-12.08a6,6,0,0,1,3.22-1,7,7,0,0,1,5.8,3.22,6,6,0,0,1,.85,3.26,7.94,7.94,0,0,1-1.13,3.8,8.06,8.06,0,0,1-2.62,3,6,6,0,0,1-3.22,1,6.55,6.55,0,0,1-3.31-.88,6.47,6.47,0,0,1-2.49-2.34,6,6,0,0,1-.85-3.26,8,8,0,0,1,1.12-3.79A8.21,8.21,0,0,1,62.35,12.15ZM47.83,6.61,59.16,7.94l-.29,2.4-4.22-.49L53.31,21.24l-2.88-.34L51.77,9.51,47.54,9Zm-25.74,9.9a6.29,6.29,0,0,1,2.25-1.3,3.38,3.38,0,0,1,2,0,3.31,3.31,0,0,1,1.58,1.07,3.09,3.09,0,0,1,.68,1.3,2.93,2.93,0,0,1,0,1.35,3.6,3.6,0,0,1-.63,1.25l.09.11a3.07,3.07,0,0,1,1.43-.62,3.2,3.2,0,0,1,1.61.15,3.44,3.44,0,0,1,1.47,1.07A3.54,3.54,0,0,1,33,24.8a5.93,5.93,0,0,1-1.68,2.08l-4.53,3.83-9-10.61ZM10.67,31a6,6,0,0,1,1.58-2.13,4.14,4.14,0,0,1,2.05-.95,3.77,3.77,0,0,1,2.19.35,4.08,4.08,0,0,1,1.27.93,6.55,6.55,0,0,1,1.08,1.72,24.19,24.19,0,0,1,1.08,2.95l.94,2.68.09,0,2.47-5.28,2.17,1-4.19,9-1.92-.89L17.43,34c-.19-.55-.37-1-.55-1.43a4.13,4.13,0,0,0-.59-1,2.26,2.26,0,0,0-.83-.63,2,2,0,0,0-1.07-.2,1.84,1.84,0,0,0-.94.4,2.37,2.37,0,0,0-.68.89,2.28,2.28,0,0,0-.24,1.11,1.75,1.75,0,0,0,.36,1,2.47,2.47,0,0,0,.93.72l-1.19,2.52a4.36,4.36,0,0,1-1.88-1.56,4.14,4.14,0,0,1-.67-2.22A5.71,5.71,0,0,1,10.67,31ZM7,48.84a5.88,5.88,0,0,1,.51-2.69,4,4,0,0,1,1.55-1.73,4.82,4.82,0,0,1,2.39-.63,4.57,4.57,0,0,1,2.39.56,3.89,3.89,0,0,1,1.55,1.7s0,.09,0,.13l5.36-3,.05,3.24L16,49.1l0,2.14,4.93-.08,0,2.94-13.89.22Zm6.06,20.4a6.69,6.69,0,0,1-2.18-2.64,6.58,6.58,0,0,1-.68-3.35,6,6,0,0,1,1.19-3.15,8.05,8.05,0,0,1,3.12-2.45,8,8,0,0,1,3.86-.89,6,6,0,0,1,3.2,1.06,7,7,0,0,1,2.86,6A6.14,6.14,0,0,1,23.22,67a8.05,8.05,0,0,1-3.11,2.43,8.21,8.21,0,0,1-3.86.9A6.07,6.07,0,0,1,13.05,69.24Zm11.81,14-8.45-7.67L18,73.78l3.15,2.86,7.71-8.49,2.15,1.95-7.71,8.49,3.15,2.86Zm18,.16a8.12,8.12,0,0,1-2.12,3.34,6,6,0,0,1-3,1.5A7,7,0,0,1,31.51,86a5.94,5.94,0,0,1-1.36-3.08A7.94,7.94,0,0,1,30.66,79a8,8,0,0,1,2.12-3.35,6,6,0,0,1,3-1.49A7,7,0,0,1,42,76.4a6,6,0,0,1,1.36,3.08A8.17,8.17,0,0,1,42.89,83.4ZM41.24,22.06a6.56,6.56,0,0,1-3.43.07,5.89,5.89,0,0,1-2.89-1.72,8.08,8.08,0,0,1-1.85-3.49,8,8,0,0,1-.21-4,6.06,6.06,0,0,1,1.59-3,7,7,0,0,1,6.4-1.77A6,6,0,0,1,43.75,10a8.06,8.06,0,0,1,1.85,3.5,8,8,0,0,1,.21,3.95,6,6,0,0,1-1.6,3A6.63,6.63,0,0,1,41.24,22.06Zm10.32,68A6.17,6.17,0,0,1,49,89.85a3.26,3.26,0,0,1-2.3-2.93,3.1,3.1,0,0,1,.21-1.45,2.68,2.68,0,0,1,.81-1.07,3.69,3.69,0,0,1,1.24-.66v-.13a3.1,3.1,0,0,1-1.52-.33,3.25,3.25,0,0,1-1.22-1.06,3.45,3.45,0,0,1-.58-1.72,3.57,3.57,0,0,1,.39-2A3.64,3.64,0,0,1,47.48,77a6.09,6.09,0,0,1,2.58-.71L56,75.8,57.1,89.64Zm19.68-6.92a5.56,5.56,0,0,1-2,1.74,6,6,0,0,1-2.52.83,4.19,4.19,0,0,1-2.22-.41A3.88,3.88,0,0,1,63,83.78a4.27,4.27,0,0,1-.5-1.51,6.66,6.66,0,0,1,.12-2,25.49,25.49,0,0,1,.83-3l.78-2.73-.05-.08-5.07,2.87-1.18-2.09,8.61-4.88,1,1.84-2,6.42c-.16.56-.29,1.06-.38,1.48a4.4,4.4,0,0,0-.1,1.16,2.43,2.43,0,0,0,.31,1,2,2,0,0,0,.76.78,1.91,1.91,0,0,0,1,.22,2.42,2.42,0,0,0,1.07-.33,2.33,2.33,0,0,0,.84-.77,1.78,1.78,0,0,0,.27-1A2.26,2.26,0,0,0,68.92,80l2.43-1.38A4.4,4.4,0,0,1,72,81,4.08,4.08,0,0,1,71.24,83.17Zm6.55-4.4-1.9-1.5,2.63-3.34-9-7.09,1.79-2.28,9,7.08,2.63-3.34,1.9,1.5ZM88.81,60a6.54,6.54,0,0,1-1.71,3,6,6,0,0,1-3,1.58,9.13,9.13,0,0,1-7.44-2.11A6,6,0,0,1,75,59.53a7,7,0,0,1,1.81-6.39,6,6,0,0,1,3-1.57,9.16,9.16,0,0,1,7.43,2.1,6,6,0,0,1,1.71,2.9A6.58,6.58,0,0,1,88.81,60Z"/></g></g></svg>
    <div id="text">
      <slot/>
    </div>
<!--    <svg style="height: 50%; margin-left: auto;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0z" fill="none"/><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/></svg>-->
    <svg v-if="!isAuthenticated" @click="goToSignUp" style="height: 35%;margin-right: 2rem;margin-left: auto;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><defs></defs><g id="图层_2" data-name="图层 2"><g id="图层_1-2" data-name="图层 1"><path class="cls-1" fill="#fff" d="M24,0A24,24,0,1,0,48,24,24,24,0,0,0,24,0Zm0,7.2a7.2,7.2,0,1,1-7.2,7.2A7.2,7.2,0,0,1,24,7.2Zm0,34.08A17.28,17.28,0,0,1,9.6,33.55c.07-4.77,9.6-7.39,14.4-7.39s14.33,2.62,14.4,7.39A17.28,17.28,0,0,1,24,41.28Z"/></g></g></svg>
    <el-dropdown v-else style="height: 50%;margin-left: auto;" @command="handleCommand">
      <span style="display: flex;align-items: center;height: 100%;">
        <svg style="height: 70%;margin-right: 2rem;margin-left: 0.5rem;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><defs></defs><g id="图层_2" data-name="图层 2"><g id="图层_1-2" data-name="图层 1"><path class="cls-1" fill="#fff" d="M24,0A24,24,0,1,0,48,24,24,24,0,0,0,24,0Zm0,7.2a7.2,7.2,0,1,1-7.2,7.2A7.2,7.2,0,0,1,24,7.2Zm0,34.08A17.28,17.28,0,0,1,9.6,33.55c.07-4.77,9.6-7.39,14.4-7.39s14.33,2.62,14.4,7.39A17.28,17.28,0,0,1,24,41.28Z"/></g></g></svg>
      </span>
      <el-dropdown-menu slot="dropdown">
        <el-dropdown-item style="color: #000000ab;font-weight: 600;" disabled>{{userEmail}}</el-dropdown-item>
        <el-dropdown-item style="color: #000000ab;" disabled divided>Your score: {{userScore}}</el-dropdown-item>
        <el-dropdown-item id="logout" :command="-1">Log out</el-dropdown-item>
      </el-dropdown-menu>
    </el-dropdown>
<!--    Dialog box for asking whether want to logout-->
    <vs-dialog prevent-close not-close v-model="logoutDialog">
      <template>
        <h4 class="not-margin">
          Want to log out?
        </h4>
      </template>
      <template #footer>
        <vs-button block border @click="logoutDialog = false">
          Cancel
        </vs-button>
        <vs-button block @click="logout">
          Yes
        </vs-button>
      </template>
    </vs-dialog>
  </div>
</template>

<script>
import {getEmail, isLogin} from "@/config/authentication";
import {signOut} from "firebase/auth";
import {auth} from "@/main";
import Stats from "@/components/Stats/stats";

export default {
  name: "bot-nav-bar",
  components: {Stats},
  props: {
    selfAvatarId: Number
  },
  mounted() {
    this.isAuthenticated = isLogin()
    if (this.isAuthenticated) {
      this.userEmail = getEmail();
      this.userScore = sessionStorage.getItem('user_score');
    }
  },
  data () {
    return {
      isAuthenticated: false,
      logoutDialog: false,
      userEmail: '',
      userScore: -1
    }
  },
  methods: {
    goHome () {
      this.$router.push('/pc/home');
    },
    handleCommand(command) {
      if (command === -1) {
        this.logoutDialog = true;
      }
    },
    logout () {
      this.logoutDialog = false;
      signOut(auth).then(() => {
        sessionStorage.removeItem('user_info');
        this.$message.success('Log out successfully');
        setTimeout(() => {
          this.$router.replace('/pc/home');
          if (this.$route.name === 'pcHome') {
            window.location.reload();
          }
        }, 2500)
      }).catch((error) => {
        console.log(error.code, error.message);
        this.$message.error("Error. Please contact admin.")
      });
    },
    goToSignUp () {
      this.$message.warning("Please sign up or sign in first to create or check your own profile! Jumping to login page...");
      setTimeout(() => {
        this.$router.push('/pc/login');
      }, 2500)
    }
  }
}
</script>

<style scoped lang="less">
#logout:hover{
  color: #ff3838;
  background-color: #ffdede;
}
/deep/.vs-dialog__footer {
  display: flex;
}
#navBar {
  background-color: black;
  color: white;
  height: 4rem;
  display: flex;
  align-items: center;
  justify-content: center;
  #text {
    display: flex;
    justify-content: space-around;
    width: 50%;
    align-items: center;
    height: 100%;
    font-family: serif;
    font-weight: 900;
    font-size: 1.3rem;
    cursor: pointer;
  }
  svg {
    cursor: pointer;
  }
  #logo {
    height: 60%;
    margin-right: auto;
    margin-left: 2rem;
  }
}
.el-icon-arrow-down {
  font-size: 12px;
}
</style>
